from typing import List
from galois import ntt, intt, primitive_root

BITS = 62
HALF_BITS = BITS >> 1
MAX_VALUE = (1<<BITS)
HALF_MAX_VALUE = (1 << HALF_BITS)

MOD = 3006819284014656913409
GEN = 3

def convert(l: List[int]) -> int:
    a = 0
    for x in l[::-1]:
        a = a * MAX_VALUE + x

    return a

def toInternal(n: int) -> List[int]:
    a: List[int] = []
    while n:
        a.append(n % MAX_VALUE)
        n //= MAX_VALUE
    return a

def cal_size(lhs: int, rhs: int) -> int:
    if lhs == 0 or rhs == 0:
        return 0
    n = 1
    while n < lhs or n < rhs:
        n <<= 1

    if n & (n - 1):
        return n
    n <<= 1
    return n
def highestPowerof2(n):
 
    res = 0;
    for i in range(n, 0, -1):
         
        # If i is a power of 2
        if ((i & (i - 1)) == 0):
         
            res = i;
            break;
         
    return res;

def cal_block_size(n: int, alloc: int) -> int:
    size = (n * BITS + HALF_BITS - 1) / HALF_BITS
    if size <= alloc:
        return alloc
    return highestPowerof2(size)
    
def bin_pow(n: int, p: int, mod: int) -> int:
    res = 1
    while p:
        if (p & 1):
            res = (res * n) % mod
        n = (n * n) % mod
        p >>= 1
    return res

def copy_to_half_block(arr: List[int], size: int) -> List[int]:
    res = [0] * size

    j = 0
    for i in range(len(arr)):
        el = arr[i]
        low = el % HALF_MAX_VALUE
        high = el // HALF_MAX_VALUE
        res[j + 0] = low
        res[j + 1] = high
        j += 2

    return res

def copy_to_full_block(arr: List[int]) -> List[int]:
    carry = 0
    for i in range(len(arr)):
        acc = carry + arr[i];
        carry = acc // HALF_MAX_VALUE
        arr[i] = acc % HALF_MAX_VALUE

    if carry:
        arr.append(carry)
        arr.append(0)
    res = [0] * len(arr)
    j = 0
    for i in range(0, len(arr), 2):
        low = arr[i + 0]
        high = arr[i + 1]
        temp = (high << HALF_BITS) | low
        res[j] = temp
        j += 1

    return res

class Montogometry:
    def __init__(self) -> None:
        self.n = MOD


def helper(LHS: List[int], RHS: List[int], size: int) -> List[int]:
    size = max(cal_block_size(len(LHS), size), cal_block_size(len(RHS), size))
    l = copy_to_half_block(LHS, size)
    r = copy_to_half_block(RHS, size)

    l = ntt(l, modulus=MOD, size=size)
    r = ntt(r, modulus=MOD, size=size)

    res = l * r

    res = intt(res, modulus=MOD, size=size, scaled=True)
    
    return copy_to_full_block(res.tolist())

LHS = toInternal(6892095116039109318691658920904047322944392300988412723404396428097709062304789071267734786274211991969541207299631563568892428136057115941615184288855432181757792138655423606915394007122203330567655798995459915806673752411425830370488012783178106692524882347778838386398354935482929364257923503624692194895205742724965900285246951106298170612516381078795759350056674123012650370643299461958286868902485393871248413841565774882569639954158438467879389185665316289585951014289657787438874496613766857837076956578681380046079396777446535994594687289869155360422129172843054554400521927004245767405535497348052128508727918337984150281274277269168858613521010097648227261484134406933830470148626764519119071097802086428914521687538649312784476329738948439724399444066928523580106924631329001792239182206040571571006381956331926515498977341847300934641835206758722225179708861114646795253948123378257466798439433730931864405736886576429923040130543699478856862989580107699802964745498703211277112858431591590618304195631647631927487945021711915014976863710873447682960741653780792849888447530133764663030310027056672152280915071157161338945887259852995996181108725112628459407485625853611284961905710448198102920670009208773412600290215884999143990903716638541233221853977254929858725232798450511256609863045029400277263903531266627205028577104822188382064533429727429837545871963401862774196381077117575376893257781925912767039001541037677008028795372469296072363462774984858737729900121280804964696611911111887160266039096516031250817569442778794510362535406167790006348748399891407720077567740671470229283935355624045174305948517422455749259396076337737178808856866587775468409441081389925835984006982327742816683974768086481389234430099315599862365862850491334285587472785708682048821677920586687657012876048506559059843064828246051495199464078107782907133942849211953600314433416828314197375137857480255787609219032034226914117720596937853029650009059702397074941862475063623380619818948276783025907006041285288826680054632185655379928821336598155373831093998818050165457251621743033073763008533815344549686611842479358062384571115892698125558442737550566589875009941068115387513030057501894903689615514605850777092314002378902528669129731322016102908152236965052553050518836697622363708863713029277047839934883834084062070128585212115749270862711308028363518409785059664040524561264510245716711612781640015326390818472107598280131606628779125210555305149825297969705157355015648246404276023703222010)
RHS = toInternal(10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000)

N = cal_size(len(LHS), len(RHS))

# print(f"PR: {primitive_root(MOD)}")
#
res = helper(LHS, RHS, N)
print(f"{res=}\nRes: {convert(res)}")

